
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>LangChain 모듈 - 체인 (Chains) &#8212; 머신러닝시스템 2024</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css?v=4c969af8" />
    <link rel="stylesheet" type="text/css" href="../_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-examples.css?v=e236af4b" />
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster.custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster.bundle.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster-sideTip-shadow.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster-sideTip-punk.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster-sideTip-noir.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster-sideTip-light.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster-sideTip-borderless.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/micromodal.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/jquery.js?v=5d32c60e"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script src="../_static/tabs.js?v=3ee01567"></script>
    <script src="../_static/js/hoverxref.js"></script>
    <script src="../_static/js/tooltipster.bundle.min.js"></script>
    <script src="../_static/js/micromodal.min.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-BQJE5V9RK2"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-BQJE5V9RK2');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-BQJE5V9RK2');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"tex": {"macros": {"N": "\\mathbb{N}", "floor": ["\\lfloor#1\\rfloor", 1], "bmat": ["\\left[\\begin{array}"], "emat": ["\\end{array}\\right]"]}}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'week13/langchain-chain';</script>
    <link rel="icon" href="https://assets.entelecheia.ai/favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="LangChain 모듈 - 메모리" href="langchain-memory.html" />
    <link rel="prev" title="LangChain 모듈 - 검색" href="langchain-retrieval.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">머신러닝시스템 2024</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    Home
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Lecture Notes</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../week01/index.html">Week 1</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../week01/intro.html">MLOps 소개</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../week02/index.html">Week 2</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../week02/devops.html">DevOps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../week02/gitops.html">GitOps</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../week03/index.html">Week 3</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../week03/dotfiles.html">Dotfiles</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../week04/index.html">Week 4</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../week04/containerization.html">컨테이너화</a></li>
<li class="toctree-l2"><a class="reference internal" href="../week04/docker.html">Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../week04/containerd.html"><code class="docutils literal notranslate"><span class="pre">containerd</span></code></a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../week05/index.html">Week 5</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../week05/hyperfast-docker.html">하이퍼패스트 도커 템플릿</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../week06/index.html">Week 6</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../week06/kubernetes.html">쿠버네티스</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../week07/index.html">Week 7</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../week07/bionic/index.html">Bionic-GPT</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../week07/bionic/introduction.html">Bionic-GPT Enterprise</a></li>
<li class="toctree-l3"><a class="reference internal" href="../week07/bionic/bare-metal.html">Kubernetes on Bare Metal</a></li>
<li class="toctree-l3"><a class="reference internal" href="../week07/bionic/installation.html">Installing Bionic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../week07/bionic/gpu-preparation.html">GPU Node Preparation (Nvidia)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../week07/bionic/sso.html">Single Sign On</a></li>
<li class="toctree-l3"><a class="reference internal" href="../week07/bionic/tgi.html">TGI Inference Engine</a></li>
<li class="toctree-l3"><a class="reference internal" href="../week07/bionic/roles.html">Role Based Access Control</a></li>
<li class="toctree-l3"><a class="reference internal" href="../week07/bionic/pgadmin.html">Integrate pgAdmin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../week07/bionic/upgrade.html">Upgrading Bionic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../week07/bionic/jupyter-notebook.html">Adding a Jupyter Notebook</a></li>
<li class="toctree-l3"><a class="reference internal" href="../week07/bionic/visualise-rag.html">Visualising RAG data</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../week09/index.html">Week 9</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../week09/sec.html">보안 관리</a></li>
<li class="toctree-l2"><a class="reference internal" href="../week09/auth-enc-sign.html">인증, 암호화 및 서명</a></li>
<li class="toctree-l2"><a class="reference internal" href="../week09/age-gpg-ssh.html">SSH, GPG, AGE 소개</a></li>
<li class="toctree-l2"><a class="reference internal" href="../week09/pass.html">Unix 패스워드 관리자</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../week10/index.html">Week 10</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../week10/autotrain.html">AutoTrain Advanced</a></li>
<li class="toctree-l2"><a class="reference internal" href="../week10/installation.html">설치</a></li>
<li class="toctree-l2"><a class="reference internal" href="../week10/starting.html">시작하기</a></li>
<li class="toctree-l2"><a class="reference internal" href="../week10/llm_finetuning.html">LLM 파인튜닝</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../week11/index.html">Week 11</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../week11/llama-factory.html">LLaMA Factory를 활용한 LLM 파인튜닝</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../week12/index.html">Week 12</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../week12/langchain.html">LangChain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../week12/langchain-io.html">LangChain - Model I/O</a></li>
<li class="toctree-l2"><a class="reference internal" href="../week12/langserve.html">LangServe로 배포하기</a></li>
<li class="toctree-l2"><a class="reference internal" href="../week12/langsmith.html">LangSmith 소개</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">Week 13</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="lcel.html">LangChain 표현 언어 (LCEL)</a></li>
<li class="toctree-l2"><a class="reference internal" href="langchain-retrieval.html">LangChain 모듈 - 검색</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">LangChain 모듈 - 체인 (Chains)</a></li>
<li class="toctree-l2"><a class="reference internal" href="langchain-memory.html">LangChain 모듈 - 메모리</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Projects</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../projects/index.html">MLOps 프로젝트</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../projects/202121010/index.html">202121010</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../projects/202121010/MMHuman3D/index.html">MMhuman3D 프로젝트</a></li>
<li class="toctree-l3"><a class="reference internal" href="../projects/202121010/LectureSync/index.html">LectureSync 프로젝트 보고서</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../projects/202021012/index.html">202021012</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../projects/202021012/DUSt3R/index.html">DUSt3R</a></li>
<li class="toctree-l3"><a class="reference internal" href="../projects/202021012/finetuning/index.html">파인튜닝(Fine-tuning)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../projects/202021012/RAG_project/index.html">RAG 프로젝트 - 제주 역사 관광지 가이드 llm</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../projects/setup.html">프로젝트 환경설정</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">About</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../syllabus/index.html">수업계획서</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/index.html">만든 사람들</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Links</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://halla.ai">인공지능학과</a></li>
<li class="toctree-l1"><a class="reference external" href="https://os2024.halla.ai">운영체제 2024</a></li>
<li class="toctree-l1"><a class="reference external" href="https://mlops2024.jeju.ai">머신러닝시스템 2024</a></li>
<li class="toctree-l1"><a class="reference external" href="https://cobots2024.halla.ai">협동로봇활용 2024</a></li>
<li class="toctree-l1"><a class="reference external" href="https://aibasics.halla.ai">AI 세상 속으로</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/entelecheia/mlops-2024" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/entelecheia/mlops-2024/edit/main/src/mlops2024/book/week13/langchain-chain.md" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/entelecheia/mlops-2024/issues/new?title=Issue%20on%20page%20%2Fweek13/langchain-chain.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/week13/langchain-chain.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>LangChain 모듈 - 체인 (Chains)</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="langchain-chains">
<h1>LangChain 모듈 - 체인 (Chains)<a class="headerlink" href="#langchain-chains" title="Link to this heading">#</a></h1>
<p>LangChain은 복잡한 애플리케이션에서 대형 언어 모델(LLM)을 활용하기 위해 설계된 도구입니다. LLM과 다른 유형의 구성 요소를 포함하는 구성 요소 체인을 생성하기 위한 프레임워크를 제공합니다. 두 가지 주요 프레임워크는 다음과 같습니다:</p>
<ul class="simple">
<li><p>LangChain 표현 언어 (LangChain Expression Language, LCEL)</p></li>
<li><p>레거시 체인 인터페이스 (Legacy Chain Interface)</p></li>
</ul>
<p>LangChain 표현 언어(LCEL)는 체인의 직관적인 구성을 가능하게 하는 구문입니다. 스트리밍, 비동기 호출, 배치 처리, 병렬화, 재시도, 대체 및 추적과 같은 고급 기능을 지원합니다. 예를 들어, 다음 코드와 같이 LCEL에서 프롬프트, 모델 및 출력 파서를 구성할 수 있습니다:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">langchain.prompts</span> <span class="kn">import</span> <span class="n">ChatPromptTemplate</span>
<span class="kn">from</span> <span class="nn">langchain.schema</span> <span class="kn">import</span> <span class="n">StrOutputParser</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">ChatOpenAI</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-3.5-turbo&quot;</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">prompt</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="o">.</span><span class="n">from_messages</span><span class="p">([</span>
    <span class="p">(</span><span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;You&#39;re a very knowledgeable historian who provides accurate and eloquent answers to historical questions.&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;human&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{question}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="p">])</span>
<span class="n">runnable</span> <span class="o">=</span> <span class="n">prompt</span> <span class="o">|</span> <span class="n">model</span> <span class="o">|</span> <span class="n">StrOutputParser</span><span class="p">()</span>

<span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">runnable</span><span class="o">.</span><span class="n">stream</span><span class="p">({</span><span class="s2">&quot;question&quot;</span><span class="p">:</span> <span class="s2">&quot;What are the seven wonders of the world&quot;</span><span class="p">}):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">chunk</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>또는 LLMChain은 구성 요소를 구성하는 LCEL과 유사한 옵션입니다. LLMChain 예시는 다음과 같습니다:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">langchain.chains</span> <span class="kn">import</span> <span class="n">LLMChain</span>

<span class="n">chain</span> <span class="o">=</span> <span class="n">LLMChain</span><span class="p">(</span><span class="n">llm</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span> <span class="n">output_parser</span><span class="o">=</span><span class="n">StrOutputParser</span><span class="p">())</span>
<span class="n">chain</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">question</span><span class="o">=</span><span class="s2">&quot;What are the seven wonders of the world&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>LangChain의 체인은 Memory 객체를 통합하여 상태를 유지할 수도 있습니다. 이를 통해 호출 간에 데이터 지속성을 제공합니다. 다음 예시에서 볼 수 있듯이:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">langchain.chains</span> <span class="kn">import</span> <span class="n">ConversationChain</span>
<span class="kn">from</span> <span class="nn">langchain.memory</span> <span class="kn">import</span> <span class="n">ConversationBufferMemory</span>

<span class="n">conversation</span> <span class="o">=</span> <span class="n">ConversationChain</span><span class="p">(</span><span class="n">llm</span><span class="o">=</span><span class="n">chat</span><span class="p">,</span> <span class="n">memory</span><span class="o">=</span><span class="n">ConversationBufferMemory</span><span class="p">())</span>
<span class="n">conversation</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;Answer briefly. What are the first 3 colors of a rainbow?&quot;</span><span class="p">)</span>
<span class="n">conversation</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;And the next 4?&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>LangChain은 또한 구조화된 출력을 얻고 체인 내에서 함수를 실행하는 데 유용한 OpenAI의 함수 호출 API와의 통합을 지원합니다. 구조화된 출력을 얻기 위해 Pydantic 클래스 또는 JsonSchema를 사용하여 출력을 지정할 수 있습니다. 예시:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">langchain.pydantic_v1</span> <span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span>
<span class="kn">from</span> <span class="nn">langchain.chains.openai_functions</span> <span class="kn">import</span> <span class="n">create_structured_output_runnable</span>
<span class="kn">from</span> <span class="nn">langchain.chat_models</span> <span class="kn">import</span> <span class="n">ChatOpenAI</span>
<span class="kn">from</span> <span class="nn">langchain.prompts</span> <span class="kn">import</span> <span class="n">ChatPromptTemplate</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The person&#39;s name&quot;</span><span class="p">)</span>
    <span class="n">age</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The person&#39;s age&quot;</span><span class="p">)</span>
    <span class="n">fav_food</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The person&#39;s favorite food&quot;</span><span class="p">)</span>

<span class="n">llm</span> <span class="o">=</span> <span class="n">ChatOpenAI</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4&quot;</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">prompt</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="o">.</span><span class="n">from_messages</span><span class="p">([</span>
    <span class="c1"># Prompt messages here</span>
<span class="p">])</span>

<span class="n">runnable</span> <span class="o">=</span> <span class="n">create_structured_output_runnable</span><span class="p">(</span><span class="n">Person</span><span class="p">,</span> <span class="n">llm</span><span class="p">,</span> <span class="n">prompt</span><span class="p">)</span>
<span class="n">runnable</span><span class="o">.</span><span class="n">invoke</span><span class="p">({</span><span class="s2">&quot;input&quot;</span><span class="p">:</span> <span class="s2">&quot;Sally is 13&quot;</span><span class="p">})</span>
</pre></div>
</div>
<p>구조화된 출력을 위해 LLMChain을 사용하는 레거시 접근 방식도 있습니다:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">langchain.chains.openai_functions</span> <span class="kn">import</span> <span class="n">create_structured_output_chain</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The person&#39;s name&quot;</span><span class="p">)</span>
    <span class="n">age</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The person&#39;s age&quot;</span><span class="p">)</span>

<span class="n">chain</span> <span class="o">=</span> <span class="n">create_structured_output_chain</span><span class="p">(</span><span class="n">Person</span><span class="p">,</span> <span class="n">llm</span><span class="p">,</span> <span class="n">prompt</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">chain</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;Sally is 13&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>LangChain은 OpenAI 함수를 활용하여 추출, 태깅, OpenAPI, 인용 QA 등 다양한 목적을 위한 특정 체인을 생성합니다.</p>
<p>추출의 맥락에서 이 과정은 구조화된 출력 체인과 유사하지만 정보 또는 엔티티 추출에 중점을 둡니다. 태깅의 경우, 문서에 감정, 언어, 스타일, 다루는 주제 또는 정치적 경향과 같은 클래스를 레이블링하는 것이 목적입니다.</p>
<p>LangChain에서 태깅이 어떻게 작동하는지는 Python 코드로 시연할 수 있습니다. 필요한 패키지를 설치하고 환경을 설정하는 것으로 시작합니다:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">langchain</span> <span class="n">openai</span>
<span class="c1"># Set env var OPENAI_API_KEY or load from a .env file:</span>
<span class="c1"># import dotenv</span>
<span class="c1"># dotenv.load_dotenv()</span>

<span class="kn">from</span> <span class="nn">langchain.chat_models</span> <span class="kn">import</span> <span class="n">ChatOpenAI</span>
<span class="kn">from</span> <span class="nn">langchain.prompts</span> <span class="kn">import</span> <span class="n">ChatPromptTemplate</span>
<span class="kn">from</span> <span class="nn">langchain.chains</span> <span class="kn">import</span> <span class="n">create_tagging_chain</span><span class="p">,</span> <span class="n">create_tagging_chain_pydantic</span>
</pre></div>
</div>
<p>태깅을 위한 스키마를 정의하고, 속성과 예상되는 유형을 지정합니다:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">schema</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;sentiment&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">},</span>
        <span class="s2">&quot;aggressiveness&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;integer&quot;</span><span class="p">},</span>
        <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">},</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">llm</span> <span class="o">=</span> <span class="n">ChatOpenAI</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-3.5-turbo-0613&quot;</span><span class="p">)</span>
<span class="n">chain</span> <span class="o">=</span> <span class="n">create_tagging_chain</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="n">llm</span><span class="p">)</span>
</pre></div>
</div>
<p>다양한 입력으로 태깅 체인을 실행한 예시는 모델이 감정, 언어 및 공격성을 해석하는 능력을 보여줍니다:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">inp</span> <span class="o">=</span> <span class="s2">&quot;Estoy increiblemente contento de haberte conocido! Creo que seremos muy buenos amigos!&quot;</span>
<span class="n">chain</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
<span class="c1"># {&#39;sentiment&#39;: &#39;positive&#39;, &#39;language&#39;: &#39;Spanish&#39;}</span>

<span class="n">inp</span> <span class="o">=</span> <span class="s2">&quot;Estoy muy enojado con vos! Te voy a dar tu merecido!&quot;</span>
<span class="n">chain</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
<span class="c1"># {&#39;sentiment&#39;: &#39;enojado&#39;, &#39;aggressiveness&#39;: 1, &#39;language&#39;: &#39;es&#39;}</span>
</pre></div>
</div>
<p>더 세밀한 제어를 위해 가능한 값, 설명 및 필수 속성을 포함하여 스키마를 더 구체적으로 정의할 수 있습니다. 이러한 향상된 제어의 예시는 다음과 같습니다:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">schema</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="c1"># Schema definitions here</span>
    <span class="p">},</span>
    <span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;language&quot;</span><span class="p">,</span> <span class="s2">&quot;sentiment&quot;</span><span class="p">,</span> <span class="s2">&quot;aggressiveness&quot;</span><span class="p">],</span>
<span class="p">}</span>

<span class="n">chain</span> <span class="o">=</span> <span class="n">create_tagging_chain</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="n">llm</span><span class="p">)</span>
</pre></div>
</div>
<p>Pydantic 스키마를 사용하여 태깅 기준을 정의할 수도 있습니다. 이는 필수 속성과 유형을 지정하는 파이썬스러운 방법을 제공합니다:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span>

<span class="k">class</span> <span class="nc">Tags</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="c1"># Class fields here</span>

<span class="n">chain</span> <span class="o">=</span> <span class="n">create_tagging_chain_pydantic</span><span class="p">(</span><span class="n">Tags</span><span class="p">,</span> <span class="n">llm</span><span class="p">)</span>
</pre></div>
</div>
<p>또한 LangChain의 메타데이터 태거 문서 변환기를 사용하여 LangChain 문서에서 메타데이터를 추출할 수 있습니다. 이는 태깅 체인과 유사한 기능을 제공하지만 LangChain 문서에 적용됩니다.</p>
<p>LangChain의 또 다른 기능은 OpenAI 함수를 사용하여 텍스트에서 인용을 추출하는 인용 검색입니다. 다음 코드에서 이를 시연합니다:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">langchain.chains</span> <span class="kn">import</span> <span class="n">create_citation_fuzzy_match_chain</span>
<span class="kn">from</span> <span class="nn">langchain.chat_models</span> <span class="kn">import</span> <span class="n">ChatOpenAI</span>

<span class="n">llm</span> <span class="o">=</span> <span class="n">ChatOpenAI</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-3.5-turbo-0613&quot;</span><span class="p">)</span>
<span class="n">chain</span> <span class="o">=</span> <span class="n">create_citation_fuzzy_match_chain</span><span class="p">(</span><span class="n">llm</span><span class="p">)</span>
<span class="c1"># Further code for running the chain and displaying results</span>
</pre></div>
</div>
<p>LangChain에서 대형 언어 모델(LLM) 애플리케이션의 체이닝은 일반적으로 프롬프트 템플릿과 LLM, 그리고 선택적으로 출력 파서를 결합하는 것을 포함합니다. 이를 수행하는 권장 방법은 LangChain 표현 언어(LCEL)를 통하는 것이지만, 레거시 LLMChain 접근 방식도 지원됩니다.</p>
<p>LCEL을 사용하면 BasePromptTemplate, BaseLanguageModel 및 BaseOutputParser가 모두 Runnable 인터페이스를 구현하고 서로 쉽게 연결될 수 있습니다. 다음 예제에서 이를 시연합니다:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">langchain.prompts</span> <span class="kn">import</span> <span class="n">PromptTemplate</span>
<span class="kn">from</span> <span class="nn">langchain.chat_models</span> <span class="kn">import</span> <span class="n">ChatOpenAI</span>
<span class="kn">from</span> <span class="nn">langchain.schema</span> <span class="kn">import</span> <span class="n">StrOutputParser</span>

<span class="n">prompt</span> <span class="o">=</span> <span class="n">PromptTemplate</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
    <span class="s2">&quot;What is a good name for a company that makes </span><span class="si">{product}</span><span class="s2">?&quot;</span>
<span class="p">)</span>
<span class="n">runnable</span> <span class="o">=</span> <span class="n">prompt</span> <span class="o">|</span> <span class="n">ChatOpenAI</span><span class="p">()</span> <span class="o">|</span> <span class="n">StrOutputParser</span><span class="p">()</span>
<span class="n">runnable</span><span class="o">.</span><span class="n">invoke</span><span class="p">({</span><span class="s2">&quot;product&quot;</span><span class="p">:</span> <span class="s2">&quot;colorful socks&quot;</span><span class="p">})</span>
<span class="c1"># Output: &#39;VibrantSocks&#39;</span>
</pre></div>
</div>
<p>LangChain의 라우팅을 통해 이전 단계의 출력이 다음 단계를 결정하는 비결정적 체인을 생성할 수 있습니다. 이는 LLM과의 상호 작용에서 일관성을 유지하고 구조화하는 데 도움이 됩니다. 예를 들어, 서로 다른 유형의 질문에 최적화된 두 개의 템플릿이 있는 경우 사용자 입력에 따라 템플릿을 선택할 수 있습니다.</p>
<p>다음은 RunnableBranch를 사용하여 LCEL로 이를 구현하는 방법입니다. RunnableBranch는 (조건, 실행 가능) 쌍 목록과 기본 실행 가능으로 초기화됩니다:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">langchain.chat_models</span> <span class="kn">from</span> <span class="nn">ChatOpenAI</span>
<span class="kn">from</span> <span class="nn">langchain.schema.output_parser</span> <span class="kn">import</span> <span class="n">StrOutputParser</span>
<span class="kn">from</span> <span class="nn">langchain.schema.runnable</span> <span class="kn">import</span> <span class="n">RunnableBranch</span>
<span class="c1"># Code for defining physics_prompt and math_prompt</span>

<span class="n">general_prompt</span> <span class="o">=</span> <span class="n">PromptTemplate</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
    <span class="s2">&quot;You are a helpful assistant. Answer the question as accurately as you can.</span><span class="se">\n\n</span><span class="si">{input}</span><span class="s2">&quot;</span>
<span class="p">)</span>
<span class="n">prompt_branch</span> <span class="o">=</span> <span class="n">RunnableBranch</span><span class="p">(</span>
    <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;topic&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;math&quot;</span><span class="p">,</span> <span class="n">math_prompt</span><span class="p">),</span>
    <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;topic&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;physics&quot;</span><span class="p">,</span> <span class="n">physics_prompt</span><span class="p">),</span>
    <span class="n">general_prompt</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># More code for setting up the classifier and final chain</span>
</pre></div>
</div>
<p>최종 체인은 주제 분류기, 프롬프트 분기, 출력 파서와 같은 다양한 구성 요소를 사용하여 입력의 주제에 따라 흐름을 결정합니다:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">itemgetter</span>
<span class="kn">from</span> <span class="nn">langchain.schema.output_parser</span> <span class="kn">import</span> <span class="n">StrOutputParser</span>
<span class="kn">from</span> <span class="nn">langchain.schema.runnable</span> <span class="kn">import</span> <span class="n">RunnablePassthrough</span>

<span class="n">final_chain</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">RunnablePassthrough</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">topic</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">)</span> <span class="o">|</span> <span class="n">classifier_chain</span><span class="p">)</span>
    <span class="o">|</span> <span class="n">prompt_branch</span>
    <span class="o">|</span> <span class="n">ChatOpenAI</span><span class="p">()</span>
    <span class="o">|</span> <span class="n">StrOutputParser</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">final_chain</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;input&quot;</span><span class="p">:</span> <span class="s2">&quot;What is the first prime number greater than 40 such that one plus the prime number is divisible by 3?&quot;</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="c1"># Output: Detailed answer to the math question</span>
</pre></div>
</div>
<p>이 접근 방식은 복잡한 쿼리를 처리하고 입력에 따라 적절하게 라우팅하는 LangChain의 유연성과 강력함을 보여줍니다.</p>
<p>언어 모델의 영역에서는 초기 호출 후에 일련의 후속 호출을 수행하는 것이 일반적인 관행입니다. 이때 한 호출의 출력을 다음 호출의 입력으로 사용합니다. 이 순차적 접근 방식은 이전 상호 작용에서 생성된 정보를 기반으로 구축하려는 경우에 특히 유용합니다. LangChain 표현 언어(LCEL)가 이러한 시퀀스를 생성하는 데 권장되는 방법이지만, SequentialChain 메서드는 여전히 이전 버전과의 호환성을 위해 문서화되어 있습니다.</p>
<p>이를 설명하기 위해 먼저 연극 시놉시스를 생성한 다음 해당 시놉시스를 기반으로 리뷰를 생성하는 시나리오를 고려해 보겠습니다. Python의 <code class="docutils literal notranslate"><span class="pre">langchain.prompts</span></code>를 사용하여 두 개의 <code class="docutils literal notranslate"><span class="pre">PromptTemplate</span></code> 인스턴스를 생성합니다: 하나는 시놉시스용이고 다른 하나는 리뷰용입니다. 다음은 이러한 템플릿을 설정하는 코드입니다:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">langchain.prompts</span> <span class="kn">import</span> <span class="n">PromptTemplate</span>

<span class="n">synopsis_prompt</span> <span class="o">=</span> <span class="n">PromptTemplate</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
    <span class="s2">&quot;You are a playwright. Given the title of play, it is your job to write a synopsis for that title.</span><span class="se">\n\n</span><span class="s2">Title: </span><span class="si">{title}</span><span class="s2">\Playwright: This is a synopsis for the above play:&quot;</span>
<span class="p">)</span>

<span class="n">review_prompt</span> <span class="o">=</span> <span class="n">PromptTemplate</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
    <span class="s2">&quot;You are a play critic from the New York Times. Given the synopsis of play, it is your job to write a review for that play.</span><span class="se">\n\n</span><span class="s2">Play Synopsis:</span><span class="se">\n</span><span class="si">{synopsis}</span><span class="se">\n</span><span class="s2">Review from a New York Times play critic of the above play:&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>LCEL 접근 방식에서는 이러한 프롬프트를 <code class="docutils literal notranslate"><span class="pre">ChatOpenAI</span></code> 및 <code class="docutils literal notranslate"><span class="pre">StrOutputParser</span></code>와 함께 체이닝하여 먼저 시놉시스를 생성한 다음 리뷰를 생성하는 시퀀스를 만듭니다. 코드 스니펫은 다음과 같습니다:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">langchain.chat_models</span> <span class="kn">import</span> <span class="n">ChatOpenAI</span>
<span class="kn">from</span> <span class="nn">langchain.schema</span> <span class="kn">import</span> <span class="n">StrOutputParser</span>

<span class="n">llm</span> <span class="o">=</span> <span class="n">ChatOpenAI</span><span class="p">()</span>
<span class="n">chain</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;synopsis&quot;</span><span class="p">:</span> <span class="n">synopsis_prompt</span> <span class="o">|</span> <span class="n">llm</span> <span class="o">|</span> <span class="n">StrOutputParser</span><span class="p">()}</span>
    <span class="o">|</span> <span class="n">review_prompt</span>
    <span class="o">|</span> <span class="n">llm</span>
    <span class="o">|</span> <span class="n">StrOutputParser</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">chain</span><span class="o">.</span><span class="n">invoke</span><span class="p">({</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Tragedy at sunset on the beach&quot;</span><span class="p">})</span>
</pre></div>
</div>
<p>시놉시스와 리뷰가 모두 필요한 경우 <code class="docutils literal notranslate"><span class="pre">RunnablePassthrough</span></code>를 사용하여 각각에 대해 별도의 체인을 만든 다음 결합할 수 있습니다:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">langchain.schema.runnable</span> <span class="kn">import</span> <span class="n">RunnablePassthrough</span>

<span class="n">synopsis_chain</span> <span class="o">=</span> <span class="n">synopsis_prompt</span> <span class="o">|</span> <span class="n">llm</span> <span class="o">|</span> <span class="n">StrOutputParser</span><span class="p">()</span>
<span class="n">review_chain</span> <span class="o">=</span> <span class="n">review_prompt</span> <span class="o">|</span> <span class="n">llm</span> <span class="o">|</span> <span class="n">StrOutputParser</span><span class="p">()</span>
<span class="n">chain</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;synopsis&quot;</span><span class="p">:</span> <span class="n">synopsis_chain</span><span class="p">}</span> <span class="o">|</span> <span class="n">RunnablePassthrough</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">review</span><span class="o">=</span><span class="n">review_chain</span><span class="p">)</span>
<span class="n">chain</span><span class="o">.</span><span class="n">invoke</span><span class="p">({</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Tragedy at sunset on the beach&quot;</span><span class="p">})</span>
</pre></div>
</div>
<p>보다 복잡한 시퀀스의 경우 <code class="docutils literal notranslate"><span class="pre">SequentialChain</span></code> 메서드가 사용됩니다. 이를 통해 여러 입력과 출력을 처리할 수 있습니다. 연극의 제목과 시대를 기반으로 시놉시스가 필요한 경우를 고려해 보겠습니다. 다음은 이를 설정하는 방법입니다:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">langchain.llms</span> <span class="kn">import</span> <span class="n">OpenAI</span>
<span class="kn">from</span> <span class="nn">langchain.chains</span> <span class="kn">import</span> <span class="n">LLMChain</span><span class="p">,</span> <span class="n">SequentialChain</span>
<span class="kn">from</span> <span class="nn">langchain.prompts</span> <span class="kn">import</span> <span class="n">PromptTemplate</span>

<span class="n">llm</span> <span class="o">=</span> <span class="n">OpenAI</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="n">synopsis_template</span> <span class="o">=</span> <span class="s2">&quot;You are a playwright. Given the title of play and the era it is set in, it is your job to write a synopsis for that title.</span><span class="se">\n\n</span><span class="s2">Title: </span><span class="si">{title}</span><span class="se">\n</span><span class="s2">Era: </span><span class="si">{era}</span><span class="se">\n</span><span class="s2">Playwright: This is a synopsis for the above play:&quot;</span>
<span class="n">synopsis_prompt_template</span> <span class="o">=</span> <span class="n">PromptTemplate</span><span class="p">(</span><span class="n">input_variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;era&quot;</span><span class="p">],</span> <span class="n">template</span><span class="o">=</span><span class="n">synopsis_template</span><span class="p">)</span>
<span class="n">synopsis_chain</span> <span class="o">=</span> <span class="n">LLMChain</span><span class="p">(</span><span class="n">llm</span><span class="o">=</span><span class="n">llm</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="n">synopsis_prompt_template</span><span class="p">,</span> <span class="n">output_key</span><span class="o">=</span><span class="s2">&quot;synopsis&quot;</span><span class="p">)</span>

<span class="n">review_template</span> <span class="o">=</span> <span class="s2">&quot;You are a play critic from the New York Times. Given the synopsis of play, it is your job to write a review for that play.</span><span class="se">\n\n</span><span class="s2">Play Synopsis:</span><span class="se">\n</span><span class="si">{synopsis}</span><span class="se">\n</span><span class="s2">Review from a New York Times play critic of the above play:&quot;</span>
<span class="n">prompt_template</span> <span class="o">=</span> <span class="n">PromptTemplate</span><span class="p">(</span><span class="n">input_variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;synopsis&quot;</span><span class="p">],</span> <span class="n">template</span><span class="o">=</span><span class="n">review_template</span><span class="p">)</span>
<span class="n">review_chain</span> <span class="o">=</span> <span class="n">LLMChain</span><span class="p">(</span><span class="n">llm</span><span class="o">=</span><span class="n">llm</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="n">prompt_template</span><span class="p">,</span> <span class="n">output_key</span><span class="o">=</span><span class="s2">&quot;review&quot;</span><span class="p">)</span>

<span class="n">overall_chain</span> <span class="o">=</span> <span class="n">SequentialChain</span><span class="p">(</span>
    <span class="n">chains</span><span class="o">=</span><span class="p">[</span><span class="n">synopsis_chain</span><span class="p">,</span> <span class="n">review_chain</span><span class="p">],</span>
    <span class="n">input_variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;era&quot;</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">],</span>
    <span class="n">output_variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;synopsis&quot;</span><span class="p">,</span> <span class="s2">&quot;review&quot;</span><span class="p">],</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">overall_chain</span><span class="p">({</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Tragedy at sunset on the beach&quot;</span><span class="p">,</span> <span class="s2">&quot;era&quot;</span><span class="p">:</span> <span class="s2">&quot;Victorian England&quot;</span><span class="p">})</span>
</pre></div>
</div>
<p>체인 전체에서 컨텍스트를 유지하거나 체인의 후반부에서 사용하려는 경우 <code class="docutils literal notranslate"><span class="pre">SimpleMemory</span></code>를 사용할 수 있습니다. 이는 복잡한 입력/출력 관계를 관리하는 데 특히 유용합니다. 예를 들어, 연극의 제목, 시대, 시놉시스, 리뷰를 기반으로 소셜 미디어 게시물을 생성하려는 시나리오에서 <code class="docutils literal notranslate"><span class="pre">SimpleMemory</span></code>는 이러한 변수를 관리하는 데 도움이 될 수 있습니다:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">langchain.memory</span> <span class="kn">import</span> <span class="n">SimpleMemory</span>
<span class="kn">from</span> <span class="nn">langchain.chains</span> <span class="kn">import</span> <span class="n">SequentialChain</span>

<span class="n">template</span> <span class="o">=</span> <span class="s2">&quot;You are a social media manager for a theater company. Given the title of play, the era it is set in, the date, time and location, the synopsis of the play, and the review of the play,</span>

 <span class="n">it</span> <span class="ow">is</span> <span class="n">your</span> <span class="n">job</span> <span class="n">to</span> <span class="n">write</span> <span class="n">a</span> <span class="n">social</span> <span class="n">media</span> <span class="n">post</span> <span class="k">for</span> <span class="n">that</span> <span class="n">play</span><span class="o">.</span>\<span class="n">n</span>\<span class="n">nHere</span> <span class="ow">is</span> <span class="n">some</span> <span class="n">context</span> <span class="n">about</span> <span class="n">the</span> <span class="n">time</span> <span class="ow">and</span> <span class="n">location</span> <span class="n">of</span> <span class="n">the</span> <span class="n">play</span><span class="p">:</span>\<span class="n">nDate</span> <span class="ow">and</span> <span class="n">Time</span><span class="p">:</span> <span class="p">{</span><span class="n">time</span><span class="p">}</span>\<span class="n">nLocation</span><span class="p">:</span> <span class="p">{</span><span class="n">location</span><span class="p">}</span>\<span class="n">n</span>\<span class="n">nPlay</span> <span class="n">Synopsis</span><span class="p">:</span>\<span class="n">n</span><span class="p">{</span><span class="n">synopsis</span><span class="p">}</span>\<span class="n">nReview</span> <span class="kn">from</span> <span class="nn">a</span> <span class="n">New</span> <span class="n">York</span> <span class="n">Times</span> <span class="n">play</span> <span class="n">critic</span> <span class="n">of</span> <span class="n">the</span> <span class="n">above</span> <span class="n">play</span><span class="p">:</span>\<span class="n">n</span><span class="p">{</span><span class="n">review</span><span class="p">}</span>\<span class="n">n</span>\<span class="n">nSocial</span> <span class="n">Media</span> <span class="n">Post</span><span class="p">:</span><span class="s2">&quot;</span>
<span class="n">prompt_template</span> <span class="o">=</span> <span class="n">PromptTemplate</span><span class="p">(</span><span class="n">input_variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;synopsis&quot;</span><span class="p">,</span> <span class="s2">&quot;review&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;location&quot;</span><span class="p">],</span> <span class="n">template</span><span class="o">=</span><span class="n">template</span><span class="p">)</span>
<span class="n">social_chain</span> <span class="o">=</span> <span class="n">LLMChain</span><span class="p">(</span><span class="n">llm</span><span class="o">=</span><span class="n">llm</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="n">prompt_template</span><span class="p">,</span> <span class="n">output_key</span><span class="o">=</span><span class="s2">&quot;social_post_text&quot;</span><span class="p">)</span>

<span class="n">overall_chain</span> <span class="o">=</span> <span class="n">SequentialChain</span><span class="p">(</span>
    <span class="n">memory</span><span class="o">=</span><span class="n">SimpleMemory</span><span class="p">(</span><span class="n">memories</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;December 25th, 8pm PST&quot;</span><span class="p">,</span> <span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="s2">&quot;Theater in the Park&quot;</span><span class="p">}),</span>
    <span class="n">chains</span><span class="o">=</span><span class="p">[</span><span class="n">synopsis_chain</span><span class="p">,</span> <span class="n">review_chain</span><span class="p">,</span> <span class="n">social_chain</span><span class="p">],</span>
    <span class="n">input_variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;era&quot;</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">],</span>
    <span class="n">output_variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;social_post_text&quot;</span><span class="p">],</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">overall_chain</span><span class="p">({</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Tragedy at sunset on the beach&quot;</span><span class="p">,</span> <span class="s2">&quot;era&quot;</span><span class="p">:</span> <span class="s2">&quot;Victorian England&quot;</span><span class="p">})</span>
</pre></div>
</div>
<p>순차적 체인 외에도 문서 작업을 위한 특수 체인이 있습니다. 이러한 각 체인은 문서 결합부터 반복적 문서 분석을 기반으로 답변 세분화, 요약을 위한 문서 내용 매핑 및 축소, 점수가 매겨진 응답을 기반으로 재순위 지정에 이르기까지 다양한 목적을 수행합니다. 이러한 체인은 추가적인 유연성과 사용자 정의를 위해 LCEL로 재생성될 수 있습니다.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">StuffDocumentsChain</span></code>은 문서 목록을 LLM에 전달되는 단일 프롬프트로 결합합니다.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RefineDocumentsChain</span></code>은 문서가 모델의 컨텍스트 용량을 초과하는 작업에 적합하며, 각 문서에 대해 답변을 반복적으로 업데이트합니다.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MapReduceDocumentsChain</span></code>은 각 문서에 개별적으로 체인을 적용한 다음 결과를 결합합니다.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MapRerankDocumentsChain</span></code>은 문서 기반 응답마다 점수를 매기고 가장 높은 점수의 응답을 선택합니다.</p></li>
</ul>
<p>다음은 LCEL을 사용하여 <code class="docutils literal notranslate"><span class="pre">MapReduceDocumentsChain</span></code>을 설정하는 방법의 예시입니다:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">langchain.chains.combine_documents</span> <span class="kn">import</span> <span class="n">collapse_docs</span><span class="p">,</span> <span class="n">split_list_of_docs</span>
<span class="kn">from</span> <span class="nn">langchain.schema</span> <span class="kn">import</span> <span class="n">Document</span><span class="p">,</span> <span class="n">StrOutputParser</span>
<span class="kn">from</span> <span class="nn">langchain.schema.prompt_template</span> <span class="kn">import</span> <span class="n">format_document</span>
<span class="kn">from</span> <span class="nn">langchain.schema.runnable</span> <span class="kn">import</span> <span class="n">RunnableParallel</span><span class="p">,</span> <span class="n">RunnablePassthrough</span>

<span class="n">llm</span> <span class="o">=</span> <span class="n">ChatAnthropic</span><span class="p">()</span>
<span class="n">document_prompt</span> <span class="o">=</span> <span class="n">PromptTemplate</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{page_content}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">partial_format_document</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">format_document</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="n">document_prompt</span><span class="p">)</span>

<span class="n">map_chain</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="n">partial_format_document</span><span class="p">}</span>
    <span class="o">|</span> <span class="n">PromptTemplate</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span><span class="s2">&quot;Summarize this content:</span><span class="se">\n\n</span><span class="si">{context}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="o">|</span> <span class="n">llm</span>
    <span class="o">|</span> <span class="n">StrOutputParser</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">map_as_doc_chain</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">RunnableParallel</span><span class="p">({</span><span class="s2">&quot;doc&quot;</span><span class="p">:</span> <span class="n">RunnablePassthrough</span><span class="p">(),</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">map_chain</span><span class="p">})</span>
    <span class="o">|</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">Document</span><span class="p">(</span><span class="n">page_content</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">],</span> <span class="n">metadata</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;doc&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">))</span>
<span class="p">)</span><span class="o">.</span><span class="n">with_config</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;Summarize (return doc)&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">format_docs</span><span class="p">(</span><span class="n">docs</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">partial_format_document</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">)</span>

<span class="n">collapse_chain</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="n">format_docs</span><span class="p">}</span>
    <span class="o">|</span> <span class="n">PromptTemplate</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span><span class="s2">&quot;Collapse this content:</span><span class="se">\n\n</span><span class="si">{context}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="o">|</span> <span class="n">llm</span>
    <span class="o">|</span> <span class="n">StrOutputParser</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">reduce_chain</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="n">format_docs</span><span class="p">}</span>
    <span class="o">|</span> <span class="n">PromptTemplate</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span><span class="s2">&quot;Combine these summaries:</span><span class="se">\n\n</span><span class="si">{context}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="o">|</span> <span class="n">llm</span>
    <span class="o">|</span> <span class="n">StrOutputParser</span><span class="p">()</span>
<span class="p">)</span><span class="o">.</span><span class="n">with_config</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;Reduce&quot;</span><span class="p">)</span>

<span class="n">map_reduce</span> <span class="o">=</span> <span class="p">(</span><span class="n">map_as_doc_chain</span><span class="o">.</span><span class="n">map</span><span class="p">()</span> <span class="o">|</span> <span class="n">collapse</span> <span class="o">|</span> <span class="n">reduce_chain</span><span class="p">)</span><span class="o">.</span><span class="n">with_config</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;Map reduce&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>이러한 구성을 통해 LCEL과 기본 언어 모델의 장점을 활용하여 문서 내용에 대한 상세하고 포괄적인 분석이 가능합니다.</p>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "entelecheia/mlops-2024",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./week13"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="langchain-retrieval.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">LangChain 모듈 - 검색</p>
      </div>
    </a>
    <a class="right-next"
       href="langchain-memory.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">LangChain 모듈 - 메모리</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By <a href='https://entelecheia.me/'>Young Joon Lee</a>
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <script
  data-embed-id="ed04ae65-928c-4ab5-912d-ce49f76450b7"
  data-base-api-url="https://chat.entelecheia.app/api/embed"
  data-brand-image-url="https://assets.entelecheia.ai/favicon.png"
  data-chat-icon="magic"
  data-sponsor-text="MLOps 2024"
  data-sponsor-link="https://chat.entelecheia.app/workspace/mlops2024"
  src="https://chat.entelecheia.app/embed/anythingllm-chat-widget.min.js">
</script>

</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>